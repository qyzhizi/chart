<mxfile host="app.diagrams.net" modified="2023-07-13T21:01:12.753Z" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36" etag="wXo-RC12eciIEmybpM8d" version="21.6.1" type="github">
  <diagram id="C5RBs43oDa-KdzZeNtuy" name="Page-1">
    <mxGraphModel dx="8140" dy="4293" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-1" parent="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="6OkuFzAiOOsREzF4TEhP-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=none;fontColor=default;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="6OkuFzAiOOsREzF4TEhP-0" target="6OkuFzAiOOsREzF4TEhP-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-0" value="&lt;font color=&quot;#ff33ff&quot; style=&quot;font-size: 18px;&quot;&gt;开始&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;labelBackgroundColor=none;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="360" y="50" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=none;fontColor=default;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="6OkuFzAiOOsREzF4TEhP-1" target="6OkuFzAiOOsREzF4TEhP-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-1" value="&lt;div style=&quot;color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px; line-height: 23px;&quot;&gt;int &lt;span style=&quot;color: #dcdcaa;&quot;&gt;main&lt;/span&gt;(&lt;span style=&quot;color: #569cd6;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;argc&lt;/span&gt;, &lt;span style=&quot;color: #569cd6;&quot;&gt;char**&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;argv&lt;/span&gt;)&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;labelBackgroundColor=none;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="245" y="130" width="350" height="50" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=none;fontColor=default;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="6OkuFzAiOOsREzF4TEhP-3" target="6OkuFzAiOOsREzF4TEhP-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;labelBackgroundColor=none;fontColor=default;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="6OkuFzAiOOsREzF4TEhP-3" target="6OkuFzAiOOsREzF4TEhP-7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-3" value="&lt;div style=&quot;color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px; line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; /* storage and defaults for command line arguments */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;struct&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;arguments&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;args&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;args&lt;/span&gt;.&lt;span style=&quot;color: #9cdcfe;&quot;&gt;inFile&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #569cd6;&quot;&gt;DEFAULT_INFILE&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;args&lt;/span&gt;.&lt;span style=&quot;color: #9cdcfe;&quot;&gt;outFile&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #569cd6;&quot;&gt;DEFAULT_OUTFILE&lt;/span&gt;; &lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;args&lt;/span&gt;.&lt;span style=&quot;color: #9cdcfe;&quot;&gt;serial&lt;/span&gt; = &lt;span style=&quot;color: #569cd6;&quot;&gt;false&lt;/span&gt;;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;align=left;labelBackgroundColor=none;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="145" y="220" width="550" height="130" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;labelBackgroundColor=none;fontColor=default;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="6OkuFzAiOOsREzF4TEhP-5" target="6OkuFzAiOOsREzF4TEhP-9">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-12" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=none;fontColor=default;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="6OkuFzAiOOsREzF4TEhP-5" target="6OkuFzAiOOsREzF4TEhP-11">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-5" value="&lt;div style=&quot;color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px; line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; /* parse cmd line args */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;rc&lt;/span&gt; = &lt;span style=&quot;color: #dcdcaa;&quot;&gt;argp_parse&lt;/span&gt;(&amp;amp;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;argp&lt;/span&gt;, &lt;span style=&quot;color: #9cdcfe;&quot;&gt;argc&lt;/span&gt;, &lt;span style=&quot;color: #9cdcfe;&quot;&gt;argv&lt;/span&gt;, &lt;span style=&quot;color: #b5cea8;&quot;&gt;0&lt;/span&gt;, &lt;span style=&quot;color: #b5cea8;&quot;&gt;0&lt;/span&gt;, &amp;amp;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;args&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c586c0;&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #9cdcfe;&quot;&gt;rc&lt;/span&gt;) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::&lt;span style=&quot;color: #9cdcfe;&quot;&gt;cerr&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style=&quot;color: #ce9178;&quot;&gt;&quot;Failed to parse command line arguments.&quot;&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::&lt;span style=&quot;color: #dcdcaa;&quot;&gt;endl&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;exit&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;rc&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;align=left;labelBackgroundColor=none;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="50" y="400" width="740" height="160" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-7" value="用于储存默认命令行参数&lt;br&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;labelBackgroundColor=none;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="760" y="235" width="230" height="100" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-9" value="传给 argp_parse 函数, argp 是一个自定义的结构体，在 ed_args.h 定义。&lt;br&gt;&amp;nbsp;解析命令行参数，保存到args" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;labelBackgroundColor=none;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="840" y="430" width="230" height="100" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;labelBackgroundColor=none;fontColor=default;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="6OkuFzAiOOsREzF4TEhP-11" target="6OkuFzAiOOsREzF4TEhP-13">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=none;fontColor=default;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="6OkuFzAiOOsREzF4TEhP-11" target="6OkuFzAiOOsREzF4TEhP-15">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-11" value="&lt;div style=&quot;color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px; line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;std::&lt;span style=&quot;color: #4ec9b0;&quot;&gt;shared_ptr&lt;/span&gt;&amp;lt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;ImgMgr&lt;/span&gt;&amp;gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;img_mgr&lt;/span&gt; = &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::&lt;span style=&quot;color: #dcdcaa;&quot;&gt;make_shared&lt;/span&gt;&amp;lt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;ImgMgr&lt;/span&gt;&amp;gt;(*&lt;span style=&quot;color: #9cdcfe;&quot;&gt;argv&lt;/span&gt;);&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;align=left;labelBackgroundColor=none;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="105" y="600" width="630" height="50" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-20" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=none;fontColor=default;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="6OkuFzAiOOsREzF4TEhP-13" target="6OkuFzAiOOsREzF4TEhP-19">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-13" value="img_mgr&amp;nbsp; 是共享指针&lt;br&gt;指向 ImgMgr 对象，将 *argv&amp;nbsp; （程序名）传给 ImgMgr 构造函数。" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;align=left;labelBackgroundColor=none;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="827" y="575" width="230" height="100" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;labelBackgroundColor=none;fontColor=default;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="6OkuFzAiOOsREzF4TEhP-15" target="6OkuFzAiOOsREzF4TEhP-17">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-26" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="6OkuFzAiOOsREzF4TEhP-15" target="6OkuFzAiOOsREzF4TEhP-25">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-15" value="&lt;div style=&quot;color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px; line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; /* read input file */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;img_mgr&lt;/span&gt;&lt;span style=&quot;color: #dcdcaa;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #dcdcaa;&quot;&gt;read_image&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;args&lt;/span&gt;.&lt;span style=&quot;color: #9cdcfe;&quot;&gt;inFile&lt;/span&gt;);&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;align=left;labelBackgroundColor=none;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="237.5" y="1035" width="365" height="50" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-22" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0;exitDx=230;exitDy=65;exitPerimeter=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="6OkuFzAiOOsREzF4TEhP-17" target="6OkuFzAiOOsREzF4TEhP-21">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-17" value="使用Magick 库&lt;br&gt;读取图片，将RGB信息保存到 自定的结构体 m_pixels" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;labelBackgroundColor=none;align=left;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="827" y="1010" width="230" height="100" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-19" value="&lt;div style=&quot;color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px; line-height: 23px;&quot;&gt;&lt;div&gt;class &lt;span style=&quot;color: #4ec9b0;&quot;&gt;ImgMgr&lt;/span&gt;&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;public:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;ImgMgr&lt;/span&gt;(&lt;span style=&quot;color: #569cd6;&quot;&gt;char&lt;/span&gt; &lt;span style=&quot;color: #569cd6;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;argv&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;~ImgMgr&lt;/span&gt;();&lt;/div&gt;&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;unsigned&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;getImgWidth&lt;/span&gt;();&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;unsigned&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;getImgHeight&lt;/span&gt;();&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;unsigned&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;getChannelDepth&lt;/span&gt;();&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;unsigned&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;getPixelCount&lt;/span&gt;();&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;pixel_t&lt;/span&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;*&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;getPixelHandle&lt;/span&gt;();&lt;/div&gt;&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;read_image&lt;/span&gt;(&lt;span style=&quot;color: #569cd6;&quot;&gt;const&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::&lt;span style=&quot;color: #4ec9b0;&quot;&gt;string&lt;/span&gt; &lt;span style=&quot;color: #569cd6;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;in_filename&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;write_image&lt;/span&gt;(&lt;span style=&quot;color: #569cd6;&quot;&gt;const&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::&lt;span style=&quot;color: #4ec9b0;&quot;&gt;string&lt;/span&gt; &lt;span style=&quot;color: #569cd6;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;out_filename&lt;/span&gt;);&lt;/div&gt;&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;test_red_dot&lt;/span&gt;(&lt;span style=&quot;color: #569cd6;&quot;&gt;const&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::&lt;span style=&quot;color: #4ec9b0;&quot;&gt;string&lt;/span&gt; &lt;span style=&quot;color: #569cd6;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;out_filename&lt;/span&gt;);&lt;/div&gt;&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;private:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;m_img_width&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;m_img_height&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;m_channel_depth&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;pixel_t&lt;/span&gt; *&lt;span style=&quot;color: #9cdcfe;&quot;&gt;m_pixels&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;};&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt;#endif&lt;/span&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt; // _IMG_MGR_HPP_&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;align=left;labelBackgroundColor=none;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="1137" y="312.5" width="573" height="625" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-24" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="6OkuFzAiOOsREzF4TEhP-21" target="6OkuFzAiOOsREzF4TEhP-23">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-21" value="&lt;div style=&quot;color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px; line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div&gt;void &lt;span style=&quot;color: #4ec9b0;&quot;&gt;ImgMgr&lt;/span&gt;::&lt;span style=&quot;color: #dcdcaa;&quot;&gt;read_image&lt;/span&gt;(&lt;span style=&quot;color: #569cd6;&quot;&gt;const&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::&lt;span style=&quot;color: #4ec9b0;&quot;&gt;string&lt;/span&gt; &lt;span style=&quot;color: #569cd6;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;in_filename&lt;/span&gt;)&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c586c0;&quot;&gt;try&lt;/span&gt; {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;Magick&lt;/span&gt;::Image img;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;img&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;read&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;in_filename&lt;/span&gt;);&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 判断是否存在透明度通道&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c586c0;&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #9cdcfe;&quot;&gt;image&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;alpha&lt;/span&gt;()) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::&lt;span style=&quot;color: #9cdcfe;&quot;&gt;cout&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style=&quot;color: #ce9178;&quot;&gt;&quot;Image has alpha channel.&quot;&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::&lt;span style=&quot;color: #dcdcaa;&quot;&gt;endl&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* populate internal data structures */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;m_img_width&lt;/span&gt; = &lt;span style=&quot;color: #9cdcfe;&quot;&gt;img&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;columns&lt;/span&gt;();&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;m_img_height&lt;/span&gt; = &lt;span style=&quot;color: #9cdcfe;&quot;&gt;img&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;rows&lt;/span&gt;();&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;m_channel_depth&lt;/span&gt; = &lt;span style=&quot;color: #9cdcfe;&quot;&gt;img&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;depth&lt;/span&gt;();&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // define the number of channels in the image&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;channels&lt;/span&gt; = &lt;span style=&quot;color: #9cdcfe;&quot;&gt;img&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;channels&lt;/span&gt;();&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c586c0;&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #569cd6;&quot;&gt;nullptr&lt;/span&gt; == &lt;span style=&quot;color: #9cdcfe;&quot;&gt;m_pixels&lt;/span&gt;) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;m_pixels&lt;/span&gt; = &lt;span style=&quot;color: #c586c0;&quot;&gt;new&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;pixel_t&lt;/span&gt;[&lt;span style=&quot;color: #dcdcaa;&quot;&gt;getPixelCount&lt;/span&gt;()];&lt;span style=&quot;color: #6a9955;&quot;&gt; // free&#39;d in destructor&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } &lt;span style=&quot;color: #c586c0;&quot;&gt;else&lt;/span&gt; {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c586c0;&quot;&gt;delete&lt;/span&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt;[]&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;m_pixels&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;m_pixels&lt;/span&gt; = &lt;span style=&quot;color: #c586c0;&quot;&gt;new&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;pixel_t&lt;/span&gt;[&lt;span style=&quot;color: #dcdcaa;&quot;&gt;getPixelCount&lt;/span&gt;()];&lt;span style=&quot;color: #6a9955;&quot;&gt; // free&#39;d in destructor&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;assert&lt;/span&gt;(&lt;span style=&quot;color: #569cd6;&quot;&gt;nullptr&lt;/span&gt; != &lt;span style=&quot;color: #9cdcfe;&quot;&gt;m_pixels&lt;/span&gt;);&lt;/div&gt;&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c586c0;&quot;&gt;#ifdef&lt;/span&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt; DEBUG&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::cout &amp;lt;&amp;lt; &lt;span style=&quot;color: #ce9178;&quot;&gt;&quot;Image: &quot;&lt;/span&gt; &amp;lt;&amp;lt; in_filename &amp;lt;&amp;lt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::endl;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::cout &amp;lt;&amp;lt; &lt;span style=&quot;color: #ce9178;&quot;&gt;&quot;Resolution: &quot;&lt;/span&gt; &amp;lt;&amp;lt; m_img_width &amp;lt;&amp;lt; &lt;span style=&quot;color: #ce9178;&quot;&gt;&quot;x&quot;&lt;/span&gt; &amp;lt;&amp;lt; m_img_height &amp;lt;&amp;lt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::endl;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::cout &amp;lt;&amp;lt; &lt;span style=&quot;color: #ce9178;&quot;&gt;&quot;Pixel channels: &quot;&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;img&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;channels&lt;/span&gt;() &amp;lt;&amp;lt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::endl;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::cout &amp;lt;&amp;lt; &lt;span style=&quot;color: #ce9178;&quot;&gt;&quot;Channel depth: &quot;&lt;/span&gt; &amp;lt;&amp;lt; m_channel_depth &amp;lt;&amp;lt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::endl;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; #endif&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* extract the pixels from the image, put them in a format we can export portably */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;const&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;Magick&lt;/span&gt;::Quantum *pixels = &lt;span style=&quot;color: #9cdcfe;&quot;&gt;img&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;getConstPixels&lt;/span&gt;(&lt;span style=&quot;color: #b5cea8;&quot;&gt;0&lt;/span&gt;, &lt;span style=&quot;color: #b5cea8;&quot;&gt;0&lt;/span&gt;, &lt;span style=&quot;color: #9cdcfe;&quot;&gt;img&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;columns&lt;/span&gt;(), &lt;span style=&quot;color: #9cdcfe;&quot;&gt;img&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;rows&lt;/span&gt;());&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c586c0;&quot;&gt;for&lt;/span&gt; (&lt;span style=&quot;color: #569cd6;&quot;&gt;unsigned&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt; = &lt;span style=&quot;color: #b5cea8;&quot;&gt;0&lt;/span&gt;; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt; &amp;lt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;img&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;rows&lt;/span&gt;(); &lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt;++) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c586c0;&quot;&gt;for&lt;/span&gt; (&lt;span style=&quot;color: #569cd6;&quot;&gt;unsigned&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt; = &lt;span style=&quot;color: #b5cea8;&quot;&gt;0&lt;/span&gt;; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt; &amp;lt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;img&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;columns&lt;/span&gt;(); &lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;++) {&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* remap to a flat buffer of pixel structs */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;unsigned&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;idx&lt;/span&gt; = &lt;span style=&quot;color: #9cdcfe;&quot;&gt;img&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;columns&lt;/span&gt;() * &lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt; + &lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;; &lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;m_pixels&lt;/span&gt;[&lt;span style=&quot;color: #9cdcfe;&quot;&gt;idx&lt;/span&gt;].&lt;span style=&quot;color: #9cdcfe;&quot;&gt;red&lt;/span&gt; &amp;nbsp; = *pixels++;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;m_pixels&lt;/span&gt;[&lt;span style=&quot;color: #9cdcfe;&quot;&gt;idx&lt;/span&gt;].&lt;span style=&quot;color: #9cdcfe;&quot;&gt;green&lt;/span&gt; = *pixels++;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;m_pixels&lt;/span&gt;[&lt;span style=&quot;color: #9cdcfe;&quot;&gt;idx&lt;/span&gt;].&lt;span style=&quot;color: #9cdcfe;&quot;&gt;blue&lt;/span&gt; &amp;nbsp;= *pixels++;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // if Pixel channels &amp;gt; 3, we have an alpha channel, skip it&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c586c0;&quot;&gt;if&lt;/span&gt; (m_channels &amp;gt; &lt;span style=&quot;color: #b5cea8;&quot;&gt;3&lt;/span&gt;) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; pixels++;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c586c0;&quot;&gt;catch&lt;/span&gt; (&lt;span style=&quot;color: #569cd6;&quot;&gt;const&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;Magick&lt;/span&gt;::Exception &amp;amp;e) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::&lt;span style=&quot;color: #9cdcfe;&quot;&gt;cerr&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style=&quot;color: #ce9178;&quot;&gt;&quot;Error reading image: &quot;&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;e&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;what&lt;/span&gt;() &amp;lt;&amp;lt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::&lt;span style=&quot;color: #dcdcaa;&quot;&gt;endl&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;align=left;labelBackgroundColor=none;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="1790" y="374" width="940" height="1400" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-23" value="&lt;div style=&quot;color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px; line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;如果有4个channels, 比如 png 出了RGB channel, 还有一个&amp;nbsp;alpha channel,&amp;nbsp; 就跳过。&lt;br&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;if&amp;nbsp;(m_channels &amp;gt;&amp;nbsp;&lt;span style=&quot;border-color: var(--border-color); color: rgb(181, 206, 168);&quot;&gt;3&lt;/span&gt;) {pixels++;}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;align=left;labelBackgroundColor=none;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="2830" y="1016" width="440" height="116" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-28" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="6OkuFzAiOOsREzF4TEhP-25" target="6OkuFzAiOOsREzF4TEhP-27">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-40" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="6OkuFzAiOOsREzF4TEhP-25" target="6OkuFzAiOOsREzF4TEhP-39">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-25" value="&lt;div style=&quot;color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px; line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; /* Instantiate our edge detector */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;CannyEdgeDetector&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;ced&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;img_mgr&lt;/span&gt;);&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;align=left;labelBackgroundColor=none;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="215" y="2200" width="412.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-30" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="6OkuFzAiOOsREzF4TEhP-27" target="6OkuFzAiOOsREzF4TEhP-29">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1330" y="2230" />
              <mxPoint x="1330" y="2230" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-27" value="img_mgr&amp;nbsp; 是共享指针，指向 ImgMgr 对象&lt;br&gt;CannyEdgeDetector 是 自定义的类，定义了 detect_edge 函数，用于实现canny 检测。" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;labelBackgroundColor=none;align=left;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="681.25" y="2180" width="230" height="100" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-32" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="6OkuFzAiOOsREzF4TEhP-29" target="6OkuFzAiOOsREzF4TEhP-31">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2780" y="2265" />
              <mxPoint x="2780" y="2265" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-33" value="&lt;font color=&quot;#ff33ff&quot; style=&quot;font-size: 17px;&quot;&gt;cu_detect_edges 函数&lt;/font&gt;" style="edgeLabel;html=1;align=left;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="6OkuFzAiOOsREzF4TEhP-32">
          <mxGeometry x="-0.2241" y="-1" relative="1" as="geometry">
            <mxPoint x="-42" y="-1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-29" value="&lt;div style=&quot;background-color: rgb(30, 30, 30); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px; line-height: 23px;&quot;&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;/// &lt;span style=&quot;color: #569cd6;&quot;&gt;\brief&lt;/span&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt; Runs the canny edge detection algorithm on an image represented by&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;/// the image manager instance this edge detection instance was constructed with.&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;///&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;CannyEdgeDetector&lt;/span&gt;::&lt;span style=&quot;color: #dcdcaa;&quot;&gt;detect_edges&lt;/span&gt;(&lt;span style=&quot;color: #569cd6;&quot;&gt;bool&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;serial&lt;/span&gt;)&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;{&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;pixel_t&lt;/span&gt; *&lt;span style=&quot;color: #9cdcfe;&quot;&gt;orig_pixels&lt;/span&gt; = &lt;span style=&quot;color: #9cdcfe;&quot;&gt;m_image_mgr&lt;/span&gt;&lt;span style=&quot;color: #dcdcaa;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #dcdcaa;&quot;&gt;getPixelHandle&lt;/span&gt;();&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;unsigned&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;input_pixel_length&lt;/span&gt; = &lt;span style=&quot;color: #9cdcfe;&quot;&gt;m_image_mgr&lt;/span&gt;&lt;span style=&quot;color: #dcdcaa;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #dcdcaa;&quot;&gt;getPixelCount&lt;/span&gt;();&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;rows&lt;/span&gt; = &lt;span style=&quot;color: #9cdcfe;&quot;&gt;m_image_mgr&lt;/span&gt;&lt;span style=&quot;color: #dcdcaa;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #dcdcaa;&quot;&gt;getImgHeight&lt;/span&gt;();&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cols&lt;/span&gt; = &lt;span style=&quot;color: #9cdcfe;&quot;&gt;m_image_mgr&lt;/span&gt;&lt;span style=&quot;color: #dcdcaa;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #dcdcaa;&quot;&gt;getImgWidth&lt;/span&gt;();&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;double&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;kernel&lt;/span&gt;[&lt;span style=&quot;color: #569cd6;&quot;&gt;KERNEL_SIZE&lt;/span&gt;][&lt;span style=&quot;color: #569cd6;&quot;&gt;KERNEL_SIZE&lt;/span&gt;];&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;populate_blur_kernel&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;kernel&lt;/span&gt;);&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;pixel_t&lt;/span&gt; *&lt;span style=&quot;color: #9cdcfe;&quot;&gt;rgb_buf&lt;/span&gt; = &lt;span style=&quot;color: #c586c0;&quot;&gt;new&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;pixel_t&lt;/span&gt;[&lt;span style=&quot;color: #9cdcfe;&quot;&gt;input_pixel_length&lt;/span&gt;];&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;pixel_channel_t&lt;/span&gt; *&lt;span style=&quot;color: #9cdcfe;&quot;&gt;single_channel_buf0&lt;/span&gt; = &lt;span style=&quot;color: #c586c0;&quot;&gt;new&lt;/span&gt; &lt;span style=&quot;color: #569cd6;&quot;&gt;pixel_channel_t&lt;/span&gt;[&lt;span style=&quot;color: #9cdcfe;&quot;&gt;input_pixel_length&lt;/span&gt;]; &lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;assert&lt;/span&gt;(&lt;span style=&quot;color: #569cd6;&quot;&gt;nullptr&lt;/span&gt; != &lt;span style=&quot;color: #9cdcfe;&quot;&gt;rgb_buf&lt;/span&gt;);&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;assert&lt;/span&gt;(&lt;span style=&quot;color: #569cd6;&quot;&gt;nullptr&lt;/span&gt; != &lt;span style=&quot;color: #9cdcfe;&quot;&gt;single_channel_buf0&lt;/span&gt;);&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::&lt;span style=&quot;color: #4ec9b0;&quot;&gt;chrono&lt;/span&gt;::&lt;span style=&quot;color: #4ec9b0;&quot;&gt;high_resolution_clock&lt;/span&gt;::&lt;span style=&quot;color: #4ec9b0;&quot;&gt;time_point&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;start&lt;/span&gt; = &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::&lt;span style=&quot;color: #4ec9b0;&quot;&gt;chrono&lt;/span&gt;::&lt;span style=&quot;color: #4ec9b0;&quot;&gt;high_resolution_clock&lt;/span&gt;::&lt;span style=&quot;color: #dcdcaa;&quot;&gt;now&lt;/span&gt;();&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: rgb(197, 134, 192);&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(86, 156, 214);&quot;&gt;true&lt;/span&gt;&lt;span style=&quot;&quot;&gt; == &lt;/span&gt;&lt;span style=&quot;color: rgb(156, 220, 254);&quot;&gt;serial&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;// cpu programming&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;        ...&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; } else { // GPU&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; //&amp;nbsp;&lt;/span&gt;&lt;/span&gt;/* this is in a different file / function so we can compile it with nvcc, while this file is compiled by g++ */&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;color: rgb(212, 212, 212);&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;font color=&quot;#d4d4d4&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/font&gt;&lt;font color=&quot;#ff33ff&quot;&gt;cu_detect_edges&lt;/font&gt;&lt;span style=&quot;color: rgb(212, 212, 212);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(156, 220, 254);&quot;&gt;single_channel_buf0&lt;/span&gt;&lt;span style=&quot;color: rgb(212, 212, 212);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(156, 220, 254);&quot;&gt;orig_pixels&lt;/span&gt;&lt;span style=&quot;color: rgb(212, 212, 212);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(156, 220, 254);&quot;&gt;rows&lt;/span&gt;&lt;span style=&quot;color: rgb(212, 212, 212);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(156, 220, 254);&quot;&gt;cols&lt;/span&gt;&lt;span style=&quot;color: rgb(212, 212, 212);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(156, 220, 254);&quot;&gt;kernel&lt;/span&gt;&lt;span style=&quot;color: rgb(212, 212, 212);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&amp;nbsp; &amp;nbsp; std::&lt;span style=&quot;color: #4ec9b0;&quot;&gt;chrono&lt;/span&gt;::&lt;span style=&quot;color: #4ec9b0;&quot;&gt;high_resolution_clock&lt;/span&gt;::&lt;span style=&quot;color: #4ec9b0;&quot;&gt;time_point&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;end&lt;/span&gt; = &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::&lt;span style=&quot;color: #4ec9b0;&quot;&gt;chrono&lt;/span&gt;::&lt;span style=&quot;color: #4ec9b0;&quot;&gt;high_resolution_clock&lt;/span&gt;::&lt;span style=&quot;color: #dcdcaa;&quot;&gt;now&lt;/span&gt;();&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;auto&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;duration&lt;/span&gt; = &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::&lt;span style=&quot;color: #4ec9b0;&quot;&gt;chrono&lt;/span&gt;::&lt;span style=&quot;color: #dcdcaa;&quot;&gt;duration_cast&lt;/span&gt;&amp;lt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::&lt;span style=&quot;color: #4ec9b0;&quot;&gt;chrono&lt;/span&gt;::&lt;span style=&quot;color: #4ec9b0;&quot;&gt;microseconds&lt;/span&gt;&amp;gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;end&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;-&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;start&lt;/span&gt;).&lt;span style=&quot;color: #dcdcaa;&quot;&gt;count&lt;/span&gt;();&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::&lt;span style=&quot;color: #9cdcfe;&quot;&gt;cout&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style=&quot;color: #ce9178;&quot;&gt;&quot;Elapsed time: &quot;&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;duration&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style=&quot;color: #ce9178;&quot;&gt;&quot; us&quot;&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::&lt;span style=&quot;color: #dcdcaa;&quot;&gt;endl&lt;/span&gt;;&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;&amp;nbsp; &amp;nbsp; /* copy edge detected image back into image mgr class so we can write it out later */&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#d4d4d4&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/font&gt;&lt;font color=&quot;#ff33ff&quot;&gt;single_channel_to_grayscale&lt;/font&gt;&lt;font color=&quot;#d4d4d4&quot;&gt;(&lt;/font&gt;&lt;span style=&quot;color: rgb(156, 220, 254);&quot;&gt;rgb_buf&lt;/span&gt;&lt;font color=&quot;#d4d4d4&quot;&gt;, &lt;/font&gt;&lt;span style=&quot;color: rgb(156, 220, 254);&quot;&gt;single_channel_buf0&lt;/span&gt;&lt;font color=&quot;#d4d4d4&quot;&gt;, &lt;/font&gt;&lt;span style=&quot;color: rgb(156, 220, 254);&quot;&gt;rows&lt;/span&gt;&lt;font color=&quot;#d4d4d4&quot;&gt;, &lt;/font&gt;&lt;span style=&quot;color: rgb(156, 220, 254);&quot;&gt;cols&lt;/span&gt;&lt;font color=&quot;#d4d4d4&quot;&gt;);&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;memcpy&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;orig_pixels&lt;/span&gt;, &lt;span style=&quot;color: #9cdcfe;&quot;&gt;rgb_buf&lt;/span&gt;, &lt;span style=&quot;color: #9cdcfe;&quot;&gt;input_pixel_length&lt;/span&gt;*&lt;span style=&quot;color: #569cd6;&quot;&gt;sizeof&lt;/span&gt;(&lt;span style=&quot;color: #4ec9b0;&quot;&gt;pixel_t&lt;/span&gt;));&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c586c0;&quot;&gt;delete&lt;/span&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt; []&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;rgb_buf&lt;/span&gt;;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c586c0;&quot;&gt;delete&lt;/span&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt; []&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;single_channel_buf0&lt;/span&gt;;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;    }&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;labelBackgroundColor=none;align=left;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="1270" y="1780" width="1180" height="970" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-35" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="6OkuFzAiOOsREzF4TEhP-31" target="6OkuFzAiOOsREzF4TEhP-34">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-37" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="6OkuFzAiOOsREzF4TEhP-31" target="6OkuFzAiOOsREzF4TEhP-36">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-38" value="&lt;font color=&quot;#ff33ff&quot; style=&quot;font-size: 16px;&quot;&gt;pixel_t&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="6OkuFzAiOOsREzF4TEhP-37">
          <mxGeometry x="0.7855" y="-2" relative="1" as="geometry">
            <mxPoint x="30" y="-2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-31" value="&lt;div style=&quot;color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px; line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div&gt;//*****************************************************************************************&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;// Entry point for serial program calling CUDA implementation&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;//*****************************************************************************************&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;cu_detect_edges&lt;/span&gt;(&lt;span style=&quot;color: #569cd6;&quot;&gt;pixel_channel_t&lt;/span&gt; &lt;span style=&quot;color: #569cd6;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;final_pixels&lt;/span&gt;, &lt;span style=&quot;color: #4ec9b0;&quot;&gt;pixel_t&lt;/span&gt; &lt;span style=&quot;color: #569cd6;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;orig_pixels&lt;/span&gt;, &lt;span style=&quot;color: #569cd6;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;rows&lt;/span&gt;, &lt;span style=&quot;color: #569cd6;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cols&lt;/span&gt;, &lt;span style=&quot;color: #569cd6;&quot;&gt;double&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;kernel&lt;/span&gt;[&lt;span style=&quot;color: #569cd6;&quot;&gt;KERNEL_SIZE&lt;/span&gt;][&lt;span style=&quot;color: #569cd6;&quot;&gt;KERNEL_SIZE&lt;/span&gt;]) &lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;&amp;nbsp; &amp;nbsp; /* kernel execution configuration parameters */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;int&lt;/span&gt; num_blks = (rows * cols) / &lt;span style=&quot;color: #b5cea8;&quot;&gt;1024&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;int&lt;/span&gt; thd_per_blk = &lt;span style=&quot;color: #b5cea8;&quot;&gt;1024&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;int&lt;/span&gt; grid = &lt;span style=&quot;color: #b5cea8;&quot;&gt;0&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;pixel_channel_t&lt;/span&gt; t_high = &lt;span style=&quot;color: #b5cea8;&quot;&gt;0xFCC&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;pixel_channel_t&lt;/span&gt; t_low = &lt;span style=&quot;color: #b5cea8;&quot;&gt;0xF5&lt;/span&gt;;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;&amp;nbsp; &amp;nbsp; /* device buffers */&lt;/span&gt; &lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;pixel_t&lt;/span&gt; *in, *out;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;pixel_channel_t&lt;/span&gt; *single_channel_buf0;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;pixel_channel_t&lt;/span&gt; *single_channel_buf1;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; pixel_channel_t_signed *deltaX;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; pixel_channel_t_signed *deltaY;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;double&lt;/span&gt; *d_blur_kernel;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;unsigned&lt;/span&gt; *idx_map;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;&amp;nbsp; &amp;nbsp; /* allocate device memory */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;cudaMalloc&lt;/span&gt;((&lt;span style=&quot;color: #569cd6;&quot;&gt;void&lt;/span&gt;**) &amp;amp;in, &lt;span style=&quot;color: #569cd6;&quot;&gt;sizeof&lt;/span&gt;(&lt;span style=&quot;color: #4ec9b0;&quot;&gt;pixel_t&lt;/span&gt;)*rows*cols); &lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;cudaMalloc&lt;/span&gt;((&lt;span style=&quot;color: #569cd6;&quot;&gt;void&lt;/span&gt;**) &amp;amp;out, &lt;span style=&quot;color: #569cd6;&quot;&gt;sizeof&lt;/span&gt;(&lt;span style=&quot;color: #4ec9b0;&quot;&gt;pixel_t&lt;/span&gt;)*rows*cols); &lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;cudaMalloc&lt;/span&gt;((&lt;span style=&quot;color: #569cd6;&quot;&gt;void&lt;/span&gt;**) &amp;amp;single_channel_buf0, &lt;span style=&quot;color: #569cd6;&quot;&gt;sizeof&lt;/span&gt;(&lt;span style=&quot;color: #569cd6;&quot;&gt;pixel_channel_t&lt;/span&gt;)*rows*cols); &lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;cudaMalloc&lt;/span&gt;((&lt;span style=&quot;color: #569cd6;&quot;&gt;void&lt;/span&gt;**) &amp;amp;single_channel_buf1, &lt;span style=&quot;color: #569cd6;&quot;&gt;sizeof&lt;/span&gt;(&lt;span style=&quot;color: #569cd6;&quot;&gt;pixel_channel_t&lt;/span&gt;)*rows*cols); &lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cudaMalloc&lt;/span&gt;((&lt;span style=&quot;color: #569cd6;&quot;&gt;void&lt;/span&gt;**) &amp;amp;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;deltaX&lt;/span&gt;, &lt;span style=&quot;color: #569cd6;&quot;&gt;sizeof&lt;/span&gt;(&lt;span style=&quot;color: #4ec9b0;&quot;&gt;pixel_channel_t_signed&lt;/span&gt;)*rows*cols);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cudaMalloc&lt;/span&gt;((&lt;span style=&quot;color: #569cd6;&quot;&gt;void&lt;/span&gt;**) &amp;amp;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;deltaY&lt;/span&gt;, &lt;span style=&quot;color: #569cd6;&quot;&gt;sizeof&lt;/span&gt;(&lt;span style=&quot;color: #4ec9b0;&quot;&gt;pixel_channel_t_signed&lt;/span&gt;)*rows*cols);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cudaMalloc&lt;/span&gt;((&lt;span style=&quot;color: #569cd6;&quot;&gt;void&lt;/span&gt;**) &amp;amp;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;idx_map&lt;/span&gt;, &lt;span style=&quot;color: #569cd6;&quot;&gt;sizeof&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;idx_map&lt;/span&gt;[&lt;span style=&quot;color: #b5cea8;&quot;&gt;0&lt;/span&gt;])*rows*cols);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cudaMalloc&lt;/span&gt;((&lt;span style=&quot;color: #569cd6;&quot;&gt;void&lt;/span&gt;**) &amp;amp;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;d_blur_kernel&lt;/span&gt;, &lt;span style=&quot;color: #569cd6;&quot;&gt;sizeof&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;d_blur_kernel&lt;/span&gt;[&lt;span style=&quot;color: #b5cea8;&quot;&gt;0&lt;/span&gt;])*&lt;span style=&quot;color: #569cd6;&quot;&gt;KERNEL_SIZE&lt;/span&gt;*&lt;span style=&quot;color: #569cd6;&quot;&gt;KERNEL_SIZE&lt;/span&gt;);&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;&amp;nbsp; &amp;nbsp; /* data transfer image pixels to device */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cudaMemcpy&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;in&lt;/span&gt;, orig_pixels, rows*cols*&lt;span style=&quot;color: #569cd6;&quot;&gt;sizeof&lt;/span&gt;(&lt;span style=&quot;color: #4ec9b0;&quot;&gt;pixel_t&lt;/span&gt;), cudaMemcpyHostToDevice);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cudaMemcpy&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;d_blur_kernel&lt;/span&gt;, kernel, &lt;span style=&quot;color: #569cd6;&quot;&gt;sizeof&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;d_blur_kernel&lt;/span&gt;[&lt;span style=&quot;color: #b5cea8;&quot;&gt;0&lt;/span&gt;])*&lt;span style=&quot;color: #569cd6;&quot;&gt;KERNEL_SIZE&lt;/span&gt;*&lt;span style=&quot;color: #569cd6;&quot;&gt;KERNEL_SIZE&lt;/span&gt;, cudaMemcpyHostToDevice);&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;&amp;nbsp; &amp;nbsp; /* run canny edge detection core - CUDA kernels */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;&amp;nbsp; &amp;nbsp; /* use streams to ensure the kernels are in the same task */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;cudaStream_t&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;stream&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cudaStreamCreate&lt;/span&gt;(&amp;amp;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;stream&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cu_apply_gaussian_filter&lt;/span&gt;&amp;lt;&amp;lt;&amp;lt;num_blks, thd_per_blk, grid, stream&amp;gt;&amp;gt;&amp;gt;(in, out, rows, cols, d_blur_kernel);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cu_compute_intensity_gradient&lt;/span&gt;&amp;lt;&amp;lt;&amp;lt;num_blks, thd_per_blk, grid, stream&amp;gt;&amp;gt;&amp;gt;(out, deltaX, deltaY, rows, cols);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cu_magnitude&lt;/span&gt;&amp;lt;&amp;lt;&amp;lt;num_blks, thd_per_blk, grid, stream&amp;gt;&amp;gt;&amp;gt;(deltaX, deltaY, single_channel_buf0, rows, cols);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cu_suppress_non_max&lt;/span&gt;&amp;lt;&amp;lt;&amp;lt;num_blks, thd_per_blk, grid, stream&amp;gt;&amp;gt;&amp;gt;(single_channel_buf0, deltaX, deltaY, single_channel_buf1, rows, cols);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cu_hysteresis_high&lt;/span&gt;&amp;lt;&amp;lt;&amp;lt;num_blks, thd_per_blk, grid, stream&amp;gt;&amp;gt;&amp;gt;(single_channel_buf0, single_channel_buf1, idx_map, t_high, rows, cols);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cu_hysteresis_low&lt;/span&gt;&amp;lt;&amp;lt;&amp;lt;num_blks, thd_per_blk, grid, stream&amp;gt;&amp;gt;&amp;gt;(single_channel_buf0, single_channel_buf1, idx_map, t_low, rows, cols);&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;&amp;nbsp; &amp;nbsp; /* wait for everything to finish */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;cudaDeviceSynchronize&lt;/span&gt;();&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;&amp;nbsp; &amp;nbsp; /* copy result back to the host */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cudaMemcpy&lt;/span&gt;(final_pixels, single_channel_buf0, rows*cols*&lt;span style=&quot;color: #569cd6;&quot;&gt;sizeof&lt;/span&gt;(&lt;span style=&quot;color: #569cd6;&quot;&gt;pixel_channel_t&lt;/span&gt;), cudaMemcpyDeviceToHost);&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;&amp;nbsp; &amp;nbsp; /* cleanup */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cudaFree&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;in&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cudaFree&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;out&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cudaFree&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;single_channel_buf0&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cudaFree&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;single_channel_buf1&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cudaFree&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;deltaX&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cudaFree&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;deltaY&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cudaFree&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;idx_map&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cudaFree&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;d_blur_kernel&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;labelBackgroundColor=none;align=left;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="2920" y="1563.75" width="1320" height="1602.5" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-34" value="&lt;div style=&quot;background-color: rgb(30, 30, 30); line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div style=&quot;color: rgb(212, 212, 212); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px;&quot;&gt;//*****************************************************************************************&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px;&quot;&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;// Entry point for serial program calling CUDA implementation&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px;&quot;&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;//*****************************************************************************************&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(212, 212, 212); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px;&quot;&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;cu_detect_edges&lt;/span&gt;(&lt;span style=&quot;color: #569cd6;&quot;&gt;pixel_channel_t&lt;/span&gt; &lt;span style=&quot;color: #569cd6;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;final_pixels&lt;/span&gt;, &lt;span style=&quot;color: #4ec9b0;&quot;&gt;pixel_t&lt;/span&gt; &lt;span style=&quot;color: #569cd6;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;orig_pixels&lt;/span&gt;, &lt;span style=&quot;color: #569cd6;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;rows&lt;/span&gt;, &lt;span style=&quot;color: #569cd6;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cols&lt;/span&gt;, &lt;span style=&quot;color: #569cd6;&quot;&gt;double&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;kernel&lt;/span&gt;[&lt;span style=&quot;color: #569cd6;&quot;&gt;KERNEL_SIZE&lt;/span&gt;][&lt;span style=&quot;color: #569cd6;&quot;&gt;KERNEL_SIZE&lt;/span&gt;]) &lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px;&quot;&gt;输入参数：&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px;&quot;&gt;orig_pixels ： 原来的像素&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px;&quot;&gt;final_pixels ： 输出的像素&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px;&quot;&gt;kernel ： 高斯核&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px;&quot;&gt;num_blks 表示 GPU块的个数，每个块的线程数：thd_per_blk = 1024， 使用的是一维grid, grid = 0&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px;&quot;&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&amp;nbsp; &amp;nbsp; /* kernel execution configuration parameters */&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;border-color: var(--border-color); color: rgb(86, 156, 214);&quot;&gt;int&lt;/span&gt;&amp;nbsp;num_blks = (rows * cols) /&amp;nbsp;&lt;span style=&quot;border-color: var(--border-color); color: rgb(181, 206, 168);&quot;&gt;1024&lt;/span&gt;;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;border-color: var(--border-color); color: rgb(86, 156, 214);&quot;&gt;int&lt;/span&gt;&amp;nbsp;thd_per_blk =&amp;nbsp;&lt;span style=&quot;border-color: var(--border-color); color: rgb(181, 206, 168);&quot;&gt;1024&lt;/span&gt;;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;border-color: var(--border-color); color: rgb(86, 156, 214);&quot;&gt;int&lt;/span&gt;&amp;nbsp;grid =&amp;nbsp;&lt;span style=&quot;border-color: var(--border-color); color: rgb(181, 206, 168);&quot;&gt;0&lt;/span&gt;;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px; border-color: var(--border-color);&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px; border-color: var(--border-color);&quot;&gt;cudaMalloc 向设备申请内存&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px; border-color: var(--border-color);&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;font style=&quot;font-size: 17px;&quot; face=&quot;Consolas, Courier New, monospace&quot; color=&quot;#d4d4d4&quot;&gt;#que cuda GPU 编程使用同一个流（stream)有同步问题吗？使用steram 有什么好处？&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;font face=&quot;Consolas, Courier New, monospace&quot; color=&quot;#d4d4d4&quot;&gt;&lt;span style=&quot;font-size: 17px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;font face=&quot;Consolas, Courier New, monospace&quot; color=&quot;#d4d4d4&quot;&gt;&lt;span style=&quot;font-size: 17px;&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;- @blk 问题：同一个stream中的CUDA kernel函数按照提交的顺序依次执行，也就是说，一个CUDA kernel函数会等待前一个CUDA kernel函数执行完成之后才会开始执行。如果后一个kernel 函数 需要上一个kernel 函数的输出，但因为是按照提交的顺序依次执行，所以就不需要创建CUDA事件来同步？&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;font face=&quot;Consolas, Courier New, monospace&quot; color=&quot;#d4d4d4&quot;&gt;&lt;span style=&quot;font-size: 17px;&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;- #ans&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;font face=&quot;Consolas, Courier New, monospace&quot; color=&quot;#d4d4d4&quot;&gt;&lt;span style=&quot;font-size: 17px;&quot;&gt;这个问题，我也是找了挺久的答案，chatgpt 并不靠谱，经常说错，不过还得到了比较好的回答。虽然我不知道答案，但是可以判断chatpgt的回答是否靠谱。&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;font face=&quot;Consolas, Courier New, monospace&quot; color=&quot;#d4d4d4&quot;&gt;&lt;span style=&quot;font-size: 17px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;font face=&quot;Consolas, Courier New, monospace&quot; color=&quot;#d4d4d4&quot;&gt;&lt;span style=&quot;font-size: 17px;&quot;&gt;chatgpt 回答：&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;font face=&quot;Consolas, Courier New, monospace&quot; color=&quot;#d4d4d4&quot;&gt;&lt;span style=&quot;font-size: 17px;&quot;&gt;是的，你的理解是正确的。在同一个流中，CUDA核函数会按照它们被提交的顺序依次执行。这意味着后一个核函数会等待前一个核函数执行完成之后才开始执行。&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;font face=&quot;Consolas, Courier New, monospace&quot; color=&quot;#d4d4d4&quot;&gt;&lt;span style=&quot;font-size: 17px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;font face=&quot;Consolas, Courier New, monospace&quot; color=&quot;#d4d4d4&quot;&gt;&lt;span style=&quot;font-size: 17px;&quot;&gt;如果后一个核函数需要上一个核函数的输出作为输入，你不需要显式地创建CUDA事件来进行同步。由于同一个流中的任务是按照提交的顺序执行的，前一个核函数的输出在后一个核函数中是可见的。CUDA运行时会自动处理数据的依赖关系，并确保正确的执行顺序和数据一致性。&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;font face=&quot;Consolas, Courier New, monospace&quot; color=&quot;#d4d4d4&quot;&gt;&lt;span style=&quot;font-size: 17px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;font face=&quot;Consolas, Courier New, monospace&quot; color=&quot;#d4d4d4&quot;&gt;&lt;span style=&quot;font-size: 17px;&quot;&gt;因此，在这种情况下，你不需要使用CUDA事件来进行显式同步。通过将这两个核函数提交到同一个流中，并按照正确的顺序提交它们，CUDA运行时会自动处理同步和数据依赖。&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(212, 212, 212); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;labelBackgroundColor=none;align=left;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="4569" y="2410" width="1011" height="1060" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-36" value="&lt;div style=&quot;color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px; line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div&gt;#define&lt;span style=&quot;color: #569cd6;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;pixel_channel_t&lt;/span&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;uint16_t&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;struct&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;pixel_t&lt;/span&gt; {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;pixel_channel_t&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;red&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;pixel_channel_t&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;green&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;pixel_channel_t&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;blue&lt;/span&gt;;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;&amp;nbsp; &amp;nbsp; /* Overloaded operators for comparing pixels */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;&amp;nbsp; &amp;nbsp; /* We only use red channel here, not sure if we need this */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;bool&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;operator==&lt;/span&gt;(&lt;span style=&quot;color: #569cd6;&quot;&gt;const&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;pixel_t&lt;/span&gt; &lt;span style=&quot;color: #569cd6;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;rhs&lt;/span&gt;) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c586c0;&quot;&gt;return&lt;/span&gt; (&lt;span style=&quot;color: #9cdcfe;&quot;&gt;red&lt;/span&gt; == &lt;span style=&quot;color: #9cdcfe;&quot;&gt;rhs&lt;/span&gt;.&lt;span style=&quot;color: #9cdcfe;&quot;&gt;red&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;bool&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;operator!=&lt;/span&gt;(&lt;span style=&quot;color: #569cd6;&quot;&gt;const&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;pixel_t&lt;/span&gt; &lt;span style=&quot;color: #569cd6;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;rhs&lt;/span&gt;) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c586c0;&quot;&gt;return&lt;/span&gt; (&lt;span style=&quot;color: #9cdcfe;&quot;&gt;red&lt;/span&gt; != &lt;span style=&quot;color: #9cdcfe;&quot;&gt;rhs&lt;/span&gt;.&lt;span style=&quot;color: #9cdcfe;&quot;&gt;red&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;bool&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;operator&amp;gt;&lt;/span&gt;(&lt;span style=&quot;color: #569cd6;&quot;&gt;const&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;pixel_t&lt;/span&gt; &lt;span style=&quot;color: #569cd6;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;rhs&lt;/span&gt;) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c586c0;&quot;&gt;return&lt;/span&gt; (&lt;span style=&quot;color: #9cdcfe;&quot;&gt;red&lt;/span&gt; &amp;gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;rhs&lt;/span&gt;.&lt;span style=&quot;color: #9cdcfe;&quot;&gt;red&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;bool&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;operator&amp;gt;=&lt;/span&gt;(&lt;span style=&quot;color: #569cd6;&quot;&gt;const&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;pixel_t&lt;/span&gt; &lt;span style=&quot;color: #569cd6;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;rhs&lt;/span&gt;) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c586c0;&quot;&gt;return&lt;/span&gt; (&lt;span style=&quot;color: #9cdcfe;&quot;&gt;red&lt;/span&gt; &amp;gt;= &lt;span style=&quot;color: #9cdcfe;&quot;&gt;rhs&lt;/span&gt;.&lt;span style=&quot;color: #9cdcfe;&quot;&gt;red&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;bool&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;operator&amp;lt;&lt;/span&gt;(&lt;span style=&quot;color: #569cd6;&quot;&gt;const&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;pixel_t&lt;/span&gt; &lt;span style=&quot;color: #569cd6;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;rhs&lt;/span&gt;) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c586c0;&quot;&gt;return&lt;/span&gt; (&lt;span style=&quot;color: #9cdcfe;&quot;&gt;red&lt;/span&gt; &amp;lt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;rhs&lt;/span&gt;.&lt;span style=&quot;color: #9cdcfe;&quot;&gt;red&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;bool&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;operator&amp;lt;=&lt;/span&gt;(&lt;span style=&quot;color: #569cd6;&quot;&gt;const&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;pixel_t&lt;/span&gt; &lt;span style=&quot;color: #569cd6;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;rhs&lt;/span&gt;) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c586c0;&quot;&gt;return&lt;/span&gt; (&lt;span style=&quot;color: #9cdcfe;&quot;&gt;red&lt;/span&gt; &amp;lt;= &lt;span style=&quot;color: #9cdcfe;&quot;&gt;rhs&lt;/span&gt;.&lt;span style=&quot;color: #9cdcfe;&quot;&gt;red&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;};&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;struct&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;pixel_t_signed&lt;/span&gt; {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;int16_t&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;red&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;int16_t&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;green&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;int16_t&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;blue&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;};&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;typedef&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;int16_t&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;pixel_channel_t_signed&lt;/span&gt;;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;labelBackgroundColor=none;align=left;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="4570" y="1180" width="630" height="970" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-42" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="6OkuFzAiOOsREzF4TEhP-39" target="6OkuFzAiOOsREzF4TEhP-41">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-45" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="6OkuFzAiOOsREzF4TEhP-39" target="6OkuFzAiOOsREzF4TEhP-43">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-39" value="&lt;div style=&quot;color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px; line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; /* run edge detection algorithm */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;ced&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;detect_edges&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;args&lt;/span&gt;.&lt;span style=&quot;color: #9cdcfe;&quot;&gt;serial&lt;/span&gt;);&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;align=left;labelBackgroundColor=none;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="215" y="2340" width="412.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-46" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="6OkuFzAiOOsREzF4TEhP-41" target="6OkuFzAiOOsREzF4TEhP-44">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="694" y="2960" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-47" value="write_image" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="6OkuFzAiOOsREzF4TEhP-46">
          <mxGeometry x="-0.2715" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-49" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="6OkuFzAiOOsREzF4TEhP-41" target="6OkuFzAiOOsREzF4TEhP-48">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-41" value="&lt;div style=&quot;color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px; line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div style=&quot;line-height: 23px;&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; /* write results */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;img_mgr&lt;/span&gt;&lt;span style=&quot;color: #dcdcaa;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #dcdcaa;&quot;&gt;write_image&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;args&lt;/span&gt;.&lt;span style=&quot;color: #9cdcfe;&quot;&gt;outFile&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::&lt;span style=&quot;color: #9cdcfe;&quot;&gt;cout&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style=&quot;color: #ce9178;&quot;&gt;&quot;Edge detection complete&quot;&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::&lt;span style=&quot;color: #dcdcaa;&quot;&gt;endl&lt;/span&gt;;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c586c0;&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color: #4fc1ff;&quot;&gt;ED_SUCCESS&lt;/span&gt;;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;align=left;labelBackgroundColor=none;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="148.75" y="2470" width="545" height="190" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-43" value="执行 detect_edges" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;labelBackgroundColor=none;align=left;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="695" y="2320" width="230" height="100" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-44" value="&lt;div style=&quot;color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 17px; line-height: 23px;&quot;&gt;&lt;div&gt;///&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;/// &lt;/span&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;\brief&lt;/span&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt; Given a filename, creat an image file using&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;/// the pixel data of this image manager instance.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;///&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;ImgMgr&lt;/span&gt;::&lt;span style=&quot;color: #dcdcaa;&quot;&gt;write_image&lt;/span&gt;(&lt;span style=&quot;color: #569cd6;&quot;&gt;const&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::&lt;span style=&quot;color: #4ec9b0;&quot;&gt;string&lt;/span&gt; &lt;span style=&quot;color: #569cd6;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;out_filename&lt;/span&gt;)&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c586c0;&quot;&gt;try&lt;/span&gt; {&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* create a new white image of the same size as our input image */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;Magick&lt;/span&gt;::Image &lt;span style=&quot;color: #dcdcaa;&quot;&gt;img&lt;/span&gt;(&lt;span style=&quot;color: #4ec9b0;&quot;&gt;Magick&lt;/span&gt;::&lt;span style=&quot;color: #dcdcaa;&quot;&gt;Geometry&lt;/span&gt;(m_img_width, m_img_height), &lt;span style=&quot;color: #4ec9b0;&quot;&gt;Magick&lt;/span&gt;::&lt;span style=&quot;color: #dcdcaa;&quot;&gt;Color&lt;/span&gt;(&lt;span style=&quot;color: #ce9178;&quot;&gt;&quot;white&quot;&lt;/span&gt;));&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* get image lock */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;img&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;modifyImage&lt;/span&gt;();&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* overwrite new image&#39;s pixels with our own */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;Magick&lt;/span&gt;::Quantum *pixels = &lt;span style=&quot;color: #9cdcfe;&quot;&gt;img&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;getPixels&lt;/span&gt;(&lt;span style=&quot;color: #b5cea8;&quot;&gt;0&lt;/span&gt;, &lt;span style=&quot;color: #b5cea8;&quot;&gt;0&lt;/span&gt;, &lt;span style=&quot;color: #9cdcfe;&quot;&gt;img&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;columns&lt;/span&gt;(), &lt;span style=&quot;color: #9cdcfe;&quot;&gt;img&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;rows&lt;/span&gt;());&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c586c0;&quot;&gt;for&lt;/span&gt; (&lt;span style=&quot;color: #569cd6;&quot;&gt;unsigned&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt; = &lt;span style=&quot;color: #b5cea8;&quot;&gt;0&lt;/span&gt;; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt; &amp;lt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;img&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;rows&lt;/span&gt;(); &lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt;++) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c586c0;&quot;&gt;for&lt;/span&gt; (&lt;span style=&quot;color: #569cd6;&quot;&gt;unsigned&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt; = &lt;span style=&quot;color: #b5cea8;&quot;&gt;0&lt;/span&gt;; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt; &amp;lt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;img&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;columns&lt;/span&gt;(); &lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;++) {&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* extract channels from our array of pixel structs */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;unsigned&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;idx&lt;/span&gt; = &lt;span style=&quot;color: #9cdcfe;&quot;&gt;img&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;columns&lt;/span&gt;() * &lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt; + &lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;; &lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; *pixels++ = &lt;span style=&quot;color: #9cdcfe;&quot;&gt;m_pixels&lt;/span&gt;[&lt;span style=&quot;color: #9cdcfe;&quot;&gt;idx&lt;/span&gt;].&lt;span style=&quot;color: #9cdcfe;&quot;&gt;red&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; *pixels++ = &lt;span style=&quot;color: #9cdcfe;&quot;&gt;m_pixels&lt;/span&gt;[&lt;span style=&quot;color: #9cdcfe;&quot;&gt;idx&lt;/span&gt;].&lt;span style=&quot;color: #9cdcfe;&quot;&gt;green&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; *pixels++ = &lt;span style=&quot;color: #9cdcfe;&quot;&gt;m_pixels&lt;/span&gt;[&lt;span style=&quot;color: #9cdcfe;&quot;&gt;idx&lt;/span&gt;].&lt;span style=&quot;color: #9cdcfe;&quot;&gt;blue&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* save image */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;img&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;syncPixels&lt;/span&gt;();&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* write to output file */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;img&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;write&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;out_filename&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c586c0;&quot;&gt;catch&lt;/span&gt; (&lt;span style=&quot;color: #569cd6;&quot;&gt;const&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;Magick&lt;/span&gt;::Exception &amp;amp;e) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::&lt;span style=&quot;color: #9cdcfe;&quot;&gt;cerr&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style=&quot;color: #ce9178;&quot;&gt;&quot;Error writing image: &quot;&lt;/span&gt; &amp;lt;&amp;lt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;e&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;what&lt;/span&gt;() &amp;lt;&amp;lt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;std&lt;/span&gt;::&lt;span style=&quot;color: #dcdcaa;&quot;&gt;endl&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;labelBackgroundColor=none;align=left;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="1023.5" y="2790" width="800" height="885" as="geometry" />
        </mxCell>
        <mxCell id="6OkuFzAiOOsREzF4TEhP-48" value="&lt;font style=&quot;font-size: 18px;&quot; color=&quot;#ff33ff&quot;&gt;结束&lt;/font&gt;" style="whiteSpace=wrap;html=1;align=center;rounded=1;glass=0;strokeWidth=1;shadow=0;labelBackgroundColor=none;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="361.25" y="2805" width="120" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
